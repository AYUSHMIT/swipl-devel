#!/bin/csh -f

if ( x$1 == x-b ) then 
    set binonly
    shift
endif

set arch = $1
set version = `cat VERSION`
set dir = `pwd`
set binout = $dir/xpce-$version-bin.tgz
set libout = $dir/xpce-$version-lib.tgz
set compress = "gzip"

if ( ! -d $dir ) mkdir $dir
if ( ! -d pl/library ) then
    ( cd pl; ln -s ../../pl/library . )
endif
if ( ! -d pl/boot ) then
    ( cd pl; ln -s ../../pl/boot . )
endif
if ( ! -d pl/include ) then
    ( cd pl; ln -s ../../pl/include . )
endif

cd ..
ln -sf xpce xpce-$version
tar cvhf - \
	xpce-$version/bin/xpce.base \
	xpce-$version/bin/xpce-client \
	xpce-$version/src/XPCE.a \
	xpce-$version/pl/src/pl-crt0.o \
	| $compress > $binout
	
if ( ! $?binonly ) then
    tar cvhf - \
	xpce-$version/INSTALL xpce-$version/README.linux \
	xpce-$version/licence \
	xpce-$version/INFO xpce-$version/README \
	xpce-$version/install xpce-$version/src/{load,xpce}.pl \
	xpce-$version/include xpce-$version/CXX/demo/{Makefile,README} \
	xpce-$version/CXX/demo/*.C xpce-$version/CXX/demo/*.bm \
	xpce-$version/STAMP xpce-$version/VERSION xpce-$version/ChangeLog \
	xpce-$version/src/{unx/client.c,h/interface.h} \
	xpce-$version/pl/src/{Makefile,mlist,dump} \
	xpce-$version/pl/*.c xpce-$version/prolog/c \
	xpce-$version/Pce xpce-$version/bitmaps xpce-$version/postscript \
	xpce-$version/prolog/{boot,lib} \
	xpce-$version/pl/{load.pl,library,boot,include} \
	xpce-$version/man/reference \
	xpce-$version/man/info \
	| $compress > $libout
endif
rm xpce-$version

cp xpce/INFO xpce/README.* xpce/INSTALL $dir

rm -f xpce/pl/{library,boot,include}

