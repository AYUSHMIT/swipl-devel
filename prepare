#!/bin/sh
# ./prepare
# 
# Run GNU autoconf to generate all configure files

version="`cat VERSION`"
server="http://gollem.science.uva.nl/cgi-bin/nph-download/SWI-Prolog"

findexe()
{ oldifs="$IFS"
  IFS=:
  for d in $PATH; do
    if [ -x $d/$1 ]; then
       IFS="$oldifs"
       return 0
    fi
  done
  IFS="$oldifs"
  return 1
}


################################################################
# Configuration
################################################################

confdir()
{ if grep AC_INIT configure.in 2>&1 >/dev/null; then
    if [ -f configure -a ! configure.in -nt configure ]; then
      return
    fi
    echo -n "Generating configure in $1 ... "
    if grep AC_CONFIG_HEADER configure.in 2>&1 >/dev/null; then
      autoheader
    fi
    autoconf
    echo done
  fi
}


if ! findexe autoconf; then
    echo 'ERROR: Cannot find GNU autoconf in $PATH'
    exit 1
fi


for f in `find . -name configure.in`; do
    d=`dirname $f`
    (cd $d && confdir $d)
done


################################################################
# Documentation check and download
################################################################

download_docs()
{ doc=pl-doc-$version.tar.gz

  echo -n "Downloading documentation for SWI-Prolog $version from $server ..."
  curl $server/generated/$doc > $doc
  ls -l $doc
  tar zxvf $doc
}


if [ ! -d man/Manual ]; then
    cat << _EOM_
WARNING: Cannot find documentation in man/Manual.  See README.git
WARNING: and README.doc for further information and how to
WARNING: download the documentation when using the GIT/CVS sources.
_EOM_
fi
    
