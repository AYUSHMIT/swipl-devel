<!DOCTYPE html>
<!--
This is the test file for SWI-Prolog WebAssembly build.
It must be served through a web server. The web server
must use correct MIME type for wasm files.
Such simple-to-use web server is http-server:
<https://www.npmjs.com/package/http-server>
Install using npm i -g http-server
Run http-server command in the swipl-devel
directory and browse to <http://localhost:8080/src/wasm/test.html>
-->
<html>
    <head>
        <meta charset="UTF-8">
        <title>SWI-Prolog WebAssembly build test</title>
    </head>
    <body>
	<pre id="output"></pre>
        <script src="/build.wasm/src/swipl-web.js"></script>
        <script>
	    output = document.getElementById('output');

	    function printErr(line) {
                const node = document.createElement('span');
                node.className = 'output-error';
                node.textContent = line + '\n';
                output.appendChild(node);
            };

            SWIPL({
                noInitialRun: true,
                arguments: [],
                locateFile: function(file) {
                    return '/build.wasm/src/' + file;
                },
		print:    (line) => { output.appendChild(document.createTextNode(line + '\n')); },
		printErr: printErr
            }).then(async (module) => {
                module.prolog.call_string("format('Hello world!~n')");
//              module.prolog.call_string("forall(current_prolog_flag(K,V), format('~q ~`.t ~40|~q~n', [K,V]))");
//              module.prolog.call_string("use_module(library(shell))");
                module.prolog.call_string("ls");
                console.log('SWI-Prolog WebAssembly ready');
            });
        </script>
    </body>
</html>
